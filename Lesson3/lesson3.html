<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lesson 3</title>
</head>
<body>
    <div id="ajax-block"></div>
    <button id="ajax-get">Async get data</button>
<script>
// let userJson = '{"name": "Ann", "age": 25, "isAdmin": true}';
// // console.log(userJson);
// let user = JSON.parse(userJson);
// // console.log(user);
// user.dateCreated = '2020-01-15';
// user.address = {
//   city: 'Moscow',
//   postalCode: 109400,
// };
// // console.log(user);
//
// let userJson2 = JSON.stringify(user, ['name', 'dateCreated', 'age', 'address', 'city', 'postalCode', 'isAdmin'], 4);
// // console.log(userJson2);
//
// let user2 = JSON.parse(userJson2, (key, value) => {
//     // console.log('key:', key);
//     // console.log('value:', value);
//     if (key === 'dateCreated') {
//         value = new Date(value);
//     }
//
//     return value;
// });
//
// console.log(user2);

// CallBack
// const num = () => {
//     let b = 0;
//     setTimeout(() => {
//         b = 20;
//     }, 2000);
//
//     return b;
// };

// const num = (a, cb) => {
//     setTimeout(() => {
//         let b = 20 + a;
//         const myData = 'test';
//         cb(b, myData);
//     }, 2000);
// };
// const callBack = (data, myData) => {
//     console.log(data, myData);
// };
// console.log(num());
// num(15, (data) => {
//     console.log(data);
// });
// num(15, callBack);

// Promises
// let num2 = (a) => {
//     return new Promise((resolve, reject) => {
//         setTimeout(() => {
//             if (a) {
//                 resolve(a + 10);
//             } else {
//                 reject({
//                     code: 3563,
//                     text: 'Error!',
//                 });
//             }
//         }, 1000);
//     });
// };
//
// // console.log(num2(5));
// num2().then((data) => { // then -> resolve
//     console.log(data);
// }).catch((error) => { // catch -> reject
//     console.log(error);
// });

window.addEventListener('load', () => {
    document.getElementById('ajax-get').addEventListener('click', () => {
// ES5
//         var xhr = new XMLHttpRequest();
//         xhr.open('GET', 'tel.json', true); // true - асинхронный запрос
//
//         xhr.onreadystatechange = () => {
//             // xhr.readyState
//             // 0 - запрос не инициализирован
//             // 1 - загрузка данных
//             // 2 - запрос принят серверов
//             // 3 - идет обмен данными
//             // 4 - запрос выполнен
//
//             if (xhr.readyState !== 4) return;
//
//             if (xhr.status !== 200) {
//                 console.log(`Error ${xhr.status} ${xhr.statusText}`);
//             } else {
//                 console.log(`Ok! ${xhr.responseText}`);
//                 let data = JSON.parse(xhr.responseText);
//                 let block = document.getElementById('ajax-block');
//                 block.insertAdjacentHTML('beforeend', `<p>${data.name} - <strong>${data.tel}</strong></p>`);
//             }
//         };
//
//         xhr.send();

        // ES6
        fetch('tel.json')
            .then(result => result.json())
            .then((data) => {
                console.log(data);
                let block = document.getElementById('ajax-block');
                block.insertAdjacentHTML('beforeend', `<p>${data.name} - <strong>${data.tel}</strong></p>`);
            })
            .catch(error => {
                console.log(error);
            });
    });
})
</script>
</body>
</html>
